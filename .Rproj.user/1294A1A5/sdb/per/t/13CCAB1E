{
    "collab_server" : "",
    "contents" : "\nbrandname = c('iwill', 'holiland', 'efdc', 'gb', 'cfxb')\nfilepath = 'C:\\\\work\\\\crawler\\\\output\\\\iwill\\\\'\noutput_path = '.\\\\output\\\\'\ni=1\n\nload('C:\\\\work\\\\liutongbu\\\\iwill cake\\\\data\\\\iwill_product.RData')\nload(paste0(filepath, brandname[i], '_comment_sen.RData'))\ncomment = get(paste0(brandname[i], '_comment'))\n\n# data----\n# bytime\nall_inf = group_by(comment, yearmonth) %>% summarise(., count = n(),\n                                                             Taste = mean(Taste),\n                                                             Envir = mean(Envir),\n                                                             Service = mean(Service),\n                                                             senti = sum(score<0) / (count+50) * 100)\nsave(all_inf, file = paste0(output_path, brandname[i], '_all_inf.RData'))\n# byshop\nshop_inf = group_by(comment, name) %>% summarise(., count = n(),\n                                                         taste = mean(Taste),\n                                                         envir = mean(Envir),\n                                                         service = mean(Service),\n                                                         senti = sum(score<0) / (count+50) * 100)\ncolnames(shop_inf)[1] = 'shop'\nsave(shop_inf, file = paste0(output_path, brandname[i], '_shop_inf.RData'))\n# byproduct\n# product = kdyjscy_product$name %>% str_replace_all(., '（.*）|\\\\(.*\\\\)', '') %>% unique(.) %>% c(., '酸菜鱼')\npLEN = length(product)\nproduct_inf = NULL\nfor(j in 1:pLEN){\n  temp_data = comment %>% .[str_detect(.$Comment, product[j])|str_detect(.$Foods, product[j]), ]\n  temp_result = c(count = nrow(temp_data),\n                  taste = mean(temp_data$Taste),\n                  envir = mean(temp_data$Envir),\n                  service = mean(temp_data$Service),\n                  senti = sum(temp_data$score<0) / (nrow(temp_data)+50) * 100 # 每100则提到负面评论数\n                  # senti = sum(temp_data$score < 0) # 负面次数\n  )\n  product_inf = rbind(product_inf, temp_result)\n}\nproduct_inf %<>% as.data.frame(.)\nproduct_inf$product = product\nsave(product_inf, file = paste0(output_path, brandname[i], '_product_inf.RData'))\n# ----\ni=i+1\n\n\n# 总体----\n# 品牌趋势----\n# _三项指标的趋势图\nall_inf1 = select(all_inf, yearmonth, Taste:Service) %>% melt(., id = 'yearmonth')\na = ggplot(all_inf1 , aes(x=yearmonth, y=value, group=variable, colour=variable)) +\n  geom_line() + theme(axis.text.x = element_text(angle = 45))\nggplotly(a, width = 1200, height = 600)\n# _情绪分数的趋势图\nggplot(all_inf , aes(x=yearmonth, y=senti, group=1, colour=1)) +\n  geom_line() + theme(axis.text.x = element_text(angle = 45))\n# 排序----\n# 产品----\n# 提到次数最多的前20项产品\nggplot(product_inf %>% arrange(., desc(count)) %>% .[2:21, ],\n       aes(x = reorder(product, desc(count)), y = count)) + \n  geom_bar(stat='identity') + theme(axis.text.x = element_text(angle = 90))\n# 味道分数最低的20项产品\nggplot(product_inf %>% arrange(., taste) %>% .[1:20, ],\n       aes(x = reorder(product, taste), y = taste, fill = count)) + \n  geom_bar(stat='identity') + theme(axis.text.x = element_text(angle = 90))\n# 负面情绪最多的前20项产品\nggplot(product_inf %>% arrange(., desc(senti)) %>% .[1:20, ],\n       aes(x = reorder(product, desc(senti)), y = senti)) + \n  geom_bar(stat='identity') + theme(axis.text.x = element_text(angle = 90))\n# 门店----\n# 提到次数最多的20间门店\nggplot(shop_inf %>% arrange(., desc(count)) %>% .[1:20, ],\n       aes(x = reorder(shop, desc(count)), y = count)) + \n  geom_bar(stat='identity') + theme(axis.text.x = element_text(angle = 90))\n# 服务分数最低的20间门店\ntemp = shop_inf %>% arrange(., service) %>% .[1:20, ]\nggplot(temp, aes(x = reorder(shop, service), y = service)) + geom_bar(stat = 'identity')\n# 负面情绪最多的20间门店\nggplot(shop_inf %>% arrange(., desc(senti)) %>% .[1:20, ],\n       aes(x = reorder(shop, desc(senti)), y = senti)) + \n  geom_bar(stat='identity') + theme(axis.text.x = element_text(angle = 90))\n# ----\n\n# 个体----\n# 单一门店----\ntarget = '月亮湾店'\ntrend_shop = comment %>% filter(., name == target)\n# 趋势\ntrend_shop %<>% group_by(., yearmonth) %>% summarise(., count = n(),\n                                                     taste = mean(Taste),\n                                                     envir = mean(Envir),\n                                                     service = mean(Service),\n                                                     senti = sum(score<0) / (count+50) * 100)\n# _三项指标\ntrend_shop2 = melt(trend_shop[,c(1,3,4,5)], id = 'yearmonth')\nggplot(trend_shop2 , aes(x=yearmonth, y=value, group=variable, color = variable)) +\n  geom_line() + theme(axis.text.x = element_text(angle = 45))\n# _负面情绪多寡\nggplot(trend_shop , aes(x=yearmonth, y=senti, group=1)) +\n  geom_line() + theme(axis.text.x = element_text(angle = 45))\n\n# 单一产品----\ntarget = '酸汤鱼'\ntrend_product = comment %>% .[str_detect(.$Comment, target), ]\n# 趋势\ntrend_product %<>% group_by(., yearmonth) %>% summarise(., count = n(),\n                                                        taste = mean(Taste),\n                                                        envir = mean(Envir),\n                                                        service = mean(Service),\n                                                        senti = sum(score<0) / (count+50) * 100)\n# _三项指标\ntrend_product2 = melt(trend_product[,c(1,3,4,5)], id = 'yearmonth')\nggplot(trend_product2 , aes(x=yearmonth, y=value, group=variable, color = variable)) +\n  geom_line() + theme(axis.text.x = element_text(angle = 45))\n# _负面情绪多寡\nggplot(trend_product , aes(x=yearmonth, y=senti, group=1)) +\n  geom_line() + theme(axis.text.x = element_text(angle = 45))\n# ----\n\n# 竞争对手热度----\ntest = str_extract_all(comment$Comment, '[跟与和][^，。、,.~!！]*比')\ntest = str_extract_all(comment$Comment, '比[^，。、,.~!！ 较]*难吃')\ntest %<>% .[lengths(.) > 0]\n# ----\n\nsave.image(file = '.\\\\data\\\\workspace.RData')\n",
    "created" : 1504158473730.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "30|17|40|0|\n",
    "hash" : "343986107",
    "id" : "13CCAB1E",
    "lastKnownWriteTime" : 1504159660,
    "last_content_update" : 1504159660788,
    "path" : "C:/work/liutongbu/kdyjscy/R/outline_brand_comment.R",
    "project_path" : "R/outline_brand_comment.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}